<div class="risk-profile-container">
    <!-- Bank Selection -->
    <mat-card class="mb-4">
        <mat-card-content>
            <mat-form-field appearance="fill" class="w-100">
                <mat-label>Select Bank</mat-label>
                <mat-select [value]="selectedBank" (selectionChange)="selectBank($event.value)">
                    <mat-option *ngFor="let bank of favoriteBanks" [value]="bank">
                        {{bank.name}} - {{bank.location}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </mat-card-content>
    </mat-card>

    <!-- Risk Profile Content -->
    <ng-container *ngIf="riskProfile">
        <!-- Overall Score -->
        <mat-card class="mb-4">
            <mat-card-header>
                <mat-card-title>Overall Risk Profile</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <div class="overall-score">
                    <div class="score-value">
                        {{riskProfile.overallScore | number:'1.0-1'}}
                    </div>
                    <div class="trend" [ngClass]="getTrendClass(riskProfile.overallTrend)">
                        <mat-icon>{{getTrendIcon(riskProfile.overallTrend)}}</mat-icon>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>

        <!-- Historical Chart -->
        <mat-card class="mb-4">
            <mat-card-header>
                <mat-card-title>Historical Risk Trend</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <div id="historical-chart"></div>
            </mat-card-content>
        </mat-card>

        <!-- Risk Categories -->
        <mat-card>
            <mat-card-header>
                <mat-card-title>Risk Categories</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <mat-accordion>
                    <mat-expansion-panel *ngFor="let category of riskProfile.categories">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                {{category.name}}
                            </mat-panel-title>
                            <mat-panel-description>
                                <span class="category-score" [ngClass]="getTrendClass(category.trend)">
                                    Score: {{category.score | number:'1.0-1'}}
                                    <mat-icon>{{getTrendIcon(category.trend)}}</mat-icon>
                                </span>
                            </mat-panel-description>
                        </mat-expansion-panel-header>

                        <p class="category-description">{{category.description}}</p>

                        <table mat-table [dataSource]="category.metrics" class="w-100">
                            <!-- Name Column -->
                            <ng-container matColumnDef="name">
                                <th mat-header-cell *matHeaderCellDef>Metric</th>
                                <td mat-cell *matCellDef="let metric">{{metric.name}}</td>
                            </ng-container>

                            <!-- Value Column -->
                            <ng-container matColumnDef="value">
                                <th mat-header-cell *matHeaderCellDef>Value</th>
                                <td mat-cell *matCellDef="let metric">{{metric.value | number:'1.2-2'}}</td>
                            </ng-container>

                            <!-- Benchmark Column -->
                            <ng-container matColumnDef="benchmark">
                                <th mat-header-cell *matHeaderCellDef>Benchmark</th>
                                <td mat-cell *matCellDef="let metric">{{metric.benchmark | number:'1.2-2'}}</td>
                            </ng-container>

                            <!-- Impact Column -->
                            <ng-container matColumnDef="impact">
                                <th mat-header-cell *matHeaderCellDef>Impact</th>
                                <td mat-cell *matCellDef="let metric">
                                    <span class="impact-indicator" [ngClass]="getImpactClass(metric.impact)">
                                        {{metric.impact}}
                                    </span>
                                </td>
                            </ng-container>

                            <!-- Trend Column -->
                            <ng-container matColumnDef="trend">
                                <th mat-header-cell *matHeaderCellDef>Trend</th>
                                <td mat-cell *matCellDef="let metric">
                                    <mat-icon [ngClass]="getTrendClass(metric.trend)">
                                        {{getTrendIcon(metric.trend)}}
                                    </mat-icon>
                                </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="['name', 'value', 'benchmark', 'impact', 'trend']">
                            </tr>
                            <tr mat-row
                                *matRowDef="let row; columns: ['name', 'value', 'benchmark', 'impact', 'trend'];"></tr>
                        </table>
                    </mat-expansion-panel>
                </mat-accordion>
            </mat-card-content>
        </mat-card>
    </ng-container>

    <!-- No Data Message -->
    <div class="no-data" *ngIf="!selectedBank">
        <mat-card>
            <mat-card-content class="text-center">
                <p>Please select a bank to view its risk profile.</p>
            </mat-card-content>
        </mat-card>
    </div>
</div>
